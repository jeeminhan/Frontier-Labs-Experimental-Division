---
export const prerender = false;
import '../styles/global.css'
import prototypes from '../data/prototypes.json'
---

<html class="light" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta content="width=device-width, initial-scale=1.0" name="viewport" />
		<title>Frontier Labs | Admin</title>
		<link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;700;900&display=swap" rel="stylesheet" />
		<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
	</head>
	<body class="bg-background-light text-stone-900 min-h-screen">
		<div class="relative flex min-h-screen flex-col overflow-x-hidden">

			<!-- Top Navigation -->
			<header class="sticky top-0 z-50 bg-background-light/95 border-b-4 border-black backdrop-blur-sm">
				<div class="max-w-[1440px] mx-auto px-6 py-4 flex items-center justify-between">
					<div class="flex items-center gap-8">
						<a href="/" class="flex items-center gap-2 group cursor-pointer no-underline text-inherit">
							<div class="bg-primary p-1 brutalist-border">
								<span class="material-symbols-outlined text-white text-2xl">terminal</span>
							</div>
							<div>
								<h1 class="text-2xl font-[900] tracking-tighter uppercase italic leading-none">Frontier Labs</h1>
								<p class="text-[9px] font-black uppercase tracking-[0.15em] text-stone-400 ml-[2px]">Experimental Division</p>
							</div>
						</a>
					</div>
					<a href="/" class="flex items-center gap-2 font-black uppercase tracking-widest text-sm hover:text-primary transition-colors no-underline text-inherit">
						<span class="material-symbols-outlined">arrow_back</span>
						Back to Feed
					</a>
				</div>
			</header>

			<main class="flex-1 max-w-[1440px] mx-auto w-full p-6 md:p-10">

				<div class="mb-8">
					<div class="flex items-center gap-3 mb-2">
						<span class="material-symbols-outlined text-primary text-3xl">admin_panel_settings</span>
						<span class="bg-red-100 text-red-700 px-2 py-0.5 text-[10px] font-black border border-red-700 uppercase">Admin</span>
					</div>
					<h2 class="text-5xl md:text-7xl font-[900] tracking-tighter uppercase leading-none mb-3">
						Link <span class="text-primary italic">Manager</span>
					</h2>
					<p class="text-base font-medium text-stone-500 max-w-xl">
						Edit feedback, slides, and video URLs for each prototype.
					</p>
				</div>

				<!-- Status Banner -->
				<div id="status-banner" class="hidden mb-6 p-4 brutalist-border font-black text-sm uppercase tracking-widest"></div>

				<form id="admin-form" class="flex flex-col gap-6">
					{Object.entries(prototypes).map(([key, proto]) => (
						<div class="bg-white brutalist-border p-6 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
							<h3 class="text-xl font-[900] uppercase tracking-tighter mb-4">{proto.name}</h3>
							<div class="mb-4">
								<label class="block text-[10px] font-black uppercase tracking-widest text-stone-400 mb-1">Prototype / Website URL</label>
								<input
									type="url"
									name={`${key}.prototypeUrl`}
									value={proto.prototypeUrl}
									placeholder="https://..."
									class="w-full px-3 py-2 brutalist-border text-sm font-mono bg-stone-50 focus:outline-none focus:ring-2 focus:ring-primary"
								/>
							</div>
							<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
								<div>
									<label class="block text-[10px] font-black uppercase tracking-widest text-stone-400 mb-1">Feedback URL</label>
									<input
										type="url"
										name={`${key}.feedbackUrl`}
										value={proto.feedbackUrl}
										placeholder="https://..."
										class="w-full px-3 py-2 brutalist-border text-sm font-mono bg-stone-50 focus:outline-none focus:ring-2 focus:ring-primary"
									/>
								</div>
								<div>
									<label class="block text-[10px] font-black uppercase tracking-widest text-stone-400 mb-1">Slides URL</label>
									<input
										type="url"
										name={`${key}.slidesUrl`}
										value={proto.slidesUrl}
										placeholder="https://..."
										class="w-full px-3 py-2 brutalist-border text-sm font-mono bg-stone-50 focus:outline-none focus:ring-2 focus:ring-primary"
									/>
								</div>
								<div>
									<label class="block text-[10px] font-black uppercase tracking-widest text-stone-400 mb-1">Video URL</label>
									<input
										type="url"
										name={`${key}.videoUrl`}
										value={proto.videoUrl}
										placeholder="https://..."
										class="w-full px-3 py-2 brutalist-border text-sm font-mono bg-stone-50 focus:outline-none focus:ring-2 focus:ring-primary"
									/>
								</div>
							</div>
						</div>
					))}

					<button
						type="submit"
						class="self-start bg-primary text-white font-black px-8 py-4 brutalist-border shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-[3px] hover:translate-y-[3px] transition-all uppercase tracking-tighter text-lg flex items-center gap-2"
					>
						<span class="material-symbols-outlined">save</span>
						Save All Links
					</button>
				</form>

			</main>

		</div>

	<script>
		const form = document.getElementById('admin-form') as HTMLFormElement;
		const banner = document.getElementById('status-banner')!;

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			const fd = new FormData(form);
			const payload: Record<string, Record<string, string>> = {};

			for (const [name, value] of fd.entries()) {
				const [key, field] = name.split('.');
				if (!payload[key]) payload[key] = {};
				payload[key][field] = value as string;
			}

			try {
				const res = await fetch('/api/prototypes', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(payload)
				});
				if (!res.ok) throw new Error('Save failed');
				banner.textContent = '✓ Links saved successfully';
				banner.className = 'mb-6 p-4 brutalist-border font-black text-sm uppercase tracking-widest bg-green-100 text-green-700 border-green-700';
			} catch {
				banner.textContent = '✗ Error saving links';
				banner.className = 'mb-6 p-4 brutalist-border font-black text-sm uppercase tracking-widest bg-red-100 text-red-700 border-red-700';
			}

			banner.classList.remove('hidden');
			setTimeout(() => banner.classList.add('hidden'), 4000);
		});
	</script>
	</body>
</html>
